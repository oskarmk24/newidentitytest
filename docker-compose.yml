services:
  mariadb:
    image: mariadb:11
    container_name: mariadb
    restart: unless-stopped
    environment:
      MARIADB_ROOT_PASSWORD: root123
      MARIADB_DATABASE: obstacledb
      MARIADB_USER: appuser
      MARIADB_PASSWORD: test123
    ports:
      - "3306:3306"           
    volumes:
      - mariadb_data:/var/lib/mysql
      - ./newidentitytest/db/init.sql:/docker-entrypoint-initdb.d/01_init.sql:ro
    networks:
        - appnet

  newidentitytest:
    build:
      context: .
      dockerfile: newidentitytest/Dockerfile
    image: newidentitytest:dev
    ports:
      - "5173:8080"           # 책pnes p책 http://localhost:5173
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ConnectionStrings__DefaultConnection: "Server=mariadb;Port=3306;Database=obstacledb;User Id=appuser;Password=test123;AllowUserVariables=True;UseAffectedRows=False;"
    networks:
        - appnet
    
  adminer:
    image: adminer
    container_name: adminer
    restart: unless-stopped
    ports:
      - "8081:8080"   # 책pne Adminer p책 http://localhost:8081
    depends_on:
      - mariadb
    networks:
        - appnet

networks:
  appnet:
      external: true
      name: appnet

volumes:
  mariadb_data:

